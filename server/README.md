# ATSAP Cluster Server

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

ATSAP Cluster Server - —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ —é–Ω–∏—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å Rightech. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –Ω–∏–º–∏.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Dependency Injection —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ InversifyJS.

##### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
- –°–µ—Ä–≤–∏—Å—ã - —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- DTO - –æ–±—ä–µ–∫—Ç—ã –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
- Entities - –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏

##### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

- –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è: TypeScript
- –§—Ä–µ–π–º–≤–æ—Ä–∫: Express.js
- –ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3001
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Dependency Injection (InversifyJS)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (class-validator)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## API

### –í–Ω–µ—à–Ω–∏–µ API

1. **Rightech API** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö –∏ –º–æ–¥–µ–ª—è—Ö
   - –ë–∞–∑–æ–≤—ã–π URL: `https://dev.rightech.io/api/v1`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bearer —Ç–æ–∫–µ–Ω (RIGHTECH_API_TOKEN)
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [https://dev.rightech.io](https://dev.rightech.io)

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

##### Units (–Æ–Ω–∏—Ç—ã)
- `GET /api/v1/units/list` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —é–Ω–∏—Ç–æ–≤

##### Objects (–û–±—ä–µ–∫—Ç—ã)
- `POST /api/v1/objects/list` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤

## üìù –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —é–Ω–∏—Ç–æ–≤
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `/api/v1/units/list`
- **–û—Ç–≤–µ—Ç**: 
  ```json
  {
    "unitsList": [
      {
        "id": "string",
        "name": "string",
        "description": "string"
      }
    ]
  }
  ```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
- **–ú–µ—Ç–æ–¥**: POST
- **URL**: `/api/v1/objects/list`
- **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**:
  ```json
  {
    "modelId": "string",
    "objectId": "string"
  }
  ```
- **–û—Ç–≤–µ—Ç**:
  ```json
  {
    "objectsList": [
      {
        "id": "string",
        "name": "string",
        "description": "string",
        "value": "any",
        "topic": "string",
        "type": "SENSOR | AUTOMATION",
        "sensorType": "HUMIDITY | TEMPERATURE",
        "sensorValueSymbol": "string"
      }
    ]
  }
  ```

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    ```
    https://github.com/efnushtaev/atsap-mqtt-brocker-proxy.git
    cd atsap-mqtt-brocker-proxy
    ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
    ```
    yarn install
    ```
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è).
4. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
    ```
    yarn run build
    ```
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
    ```
    yarn start
    ```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8001

#### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

1. –°–æ–±–µ—Ä–∏—Ç–µ Docker-–æ–±—Ä–∞–∑:
    ```
    docker build -t atsap-mqtt-brocker-proxy .
    ```
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
    ```
    docker run --env-file .env -p 3000:8001 atsap-mqtt-brocker-proxy
    ```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:3000.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `.env`:

    RIGHTECH_API_TOKEN=your_rightech_api_token    // –¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Rightech API.
    NODE_ENV=production                           // –°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (development, production).
    PORT=8001                                     // –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

    
